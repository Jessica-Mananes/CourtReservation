<?php
session_start();

if (!isset($_SESSION['admin_logged_in'])) {
    header("Location: index.html");
    exit;
}
?>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Dashboard</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

<style>
body {
    font-family: 'Poppins', sans-serif;
    margin: 0;
    background-image: url('bgCourt.png');
    background-size: cover;
    padding: 20px;
}

h1 {
    color: #3b4fe0;
    text-align: center;
}

.dashboard-container {
    max-width: 1200px;
    margin: auto;
    background: white;
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0px 5px 20px rgba(0,0,0,0.1);
}

table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
}

table, th, td {
    border: 1px solid #ccc;
}

th {
    background: #3b4fe0;
    color: white;
}

td, th {
    padding: 12px;
    text-align: center;
}

.action-dropdown {
    padding: 5px;
    border-radius: 8px;
}

.logout-btn {
    background: #e03b3b;
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    margin-top: 20px;
    font-size: 16px;
}

.logout-btn:hover {
    background: #b22a2a;
}
</style>
</head>

<body>

<h1>Admin Dashboard</h1>

<div class="dashboard-container">
    <table id="userTable">
        <thead>
            <tr>
                <th>ID</th>
                <th>NAME</th>
                <th>EMAIL</th>
                <th>DATE</th>
                <th>TIME</th>
                <th>STATUS</th>
                <th>ACTIONS</th>
            </tr>
        </thead>
        <tbody id="tableBody"></tbody>
    </table>

    <button class="logout-btn" onclick="logout()">Logout</button>
</div>

<script>
// Load table from DB
function loadTable() {
    fetch("load_reservations.php")
    .then(response => response.json())
    .then(data => {
        let tbody = document.getElementById("tableBody");
        tbody.innerHTML = "";

        data.forEach(row => {
            tbody.innerHTML += `
                <tr>
                    <td>${row.id}</td>
                    <td>${row.name}</td>
                    <td>${row.email}</td>
                    <td>${row.date_reserve}</td>
                   <td>${row.start_time} - ${row.end_time}</td>
                    <td>${row.status}</td>
                    <td>
                        <select onchange="handleAction(this.value, ${row.id})" class="action-dropdown">
                            <option value="">Select Action</option>
                            <option value="approve">Approve</option>
                            <option value="decline">Decline</option>
                            <option value="edit">Edit</option>
                            <option value="delete">Delete</option>
                        </select>
                    </td>
                </tr>
            `;
        });
    });
}

function handleAction(action, id) {
    if (action === "edit") {
        let newName = prompt("Enter new Name:");
        let newDate = prompt("Enter new Date (YYYY-MM-DD):");
       let newStartTime = prompt("Enter new Start Time (HH:MM):");
       let newEndTime = prompt("Enter new End Time (HH:MM):");
        let newStatus = prompt("Enter Status (Pending, Approved, Declined, Done):");

        if (!newName || !newDate || !newTime || !newStatus) {
            alert("All fields are required.");
            return;
        }

        fetch("update_reservation.php", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                id,
                name: newName,
                date: newDate,
                start_time: newStartTime,
                end_time: newEndTime,
                status: newStatus
            })
        })
        .then(res => res.text())
        .then(() => loadTable());
        return;
    }

    if (action === "delete") {
        if (!confirm("Are you sure you want to delete this reservation?")) return;
    }

    // Approve | Decline | Delete
    fetch(`action.php?action=${action}&id=${id}`)
        .then(() => loadTable());
}

function logout() {
    window.location.href = "logout.php";
}

// Load table at start
loadTable();
</script>

</body>
</html>
